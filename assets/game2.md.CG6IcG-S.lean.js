import{d as P,p as C,v as K,V,c as w,o as g,j as h,_ as k,G as A}from"./chunks/framework.BGwacL8i.js";const O={class:"game-container"},G=P({__name:"Game2",setup(m){const d=C(null);let c=null,t=null;function o(e){console.log(`[Game2.vue] ${e}`)}K(async()=>{o("onMounted 开始执行"),typeof window<"u"?(t=await V(()=>import("./chunks/phaser.x5T6U4cP.js").then(e=>e.p),[]).then(e=>e.default||e),o("Phaser已可用！版本: "+t.VERSION),b()):o("Phaser只能在客户端环境中运行")});function b(){if(o("开始初始化游戏"),!d.value||!t){o("游戏容器或Phaser不存在");return}try{const e={type:t.AUTO,width:800,height:600,parent:d.value,scene:{preload:_,create:x,update:v},physics:{default:"arcade",arcade:{gravity:{x:0,y:0},debug:!1}}};c=new t.Game(e),o("游戏初始化成功")}catch(e){o(`游戏初始化失败: ${e}`)}}function _(){o("preload函数被调用"),this.load.image("player","https://labs.phaser.io/assets/sprites/orange-cat1.png"),this.load.image("wall","https://labs.phaser.io/assets/sprites/block.png"),this.load.image("floor","https://labs.phaser.io/assets/sprites/diamond.png"),this.load.image("sword","https://labs.phaser.io/assets/sprites/bullet.png"),this.load.image("background","https://labs.phaser.io/assets/skies/dungeon.png")}function x(){o("create函数被调用"),this.add.image(400,300,"background").setScale(2),this.floorGroup=this.physics.add.staticGroup();for(let e=0;e<800;e+=40)for(let s=0;s<600;s+=40)this.floorGroup.create(e,s,"floor").setScale(.5);this.player=this.physics.add.sprite(400,300,"player"),this.player.setCollideWorldBounds(!0),this.player.setScale(1.5),this.obstacles=this.physics.add.staticGroup(),M.call(this),this.sword=this.physics.add.sprite(this.player.x,this.player.y,"sword"),this.sword.setScale(5),this.sword.setVisible(!1),this.cursors=this.input.keyboard.createCursorKeys(),this.wasd={w:this.input.keyboard.addKey(t.Input.Keyboard.KeyCodes.W),a:this.input.keyboard.addKey(t.Input.Keyboard.KeyCodes.A),s:this.input.keyboard.addKey(t.Input.Keyboard.KeyCodes.S),d:this.input.keyboard.addKey(t.Input.Keyboard.KeyCodes.D)},this.input.on("pointerdown",()=>{S.call(this)},this),this.input.on("pointermove",e=>{this.mouseX=e.x,this.mouseY=e.y},this),this.physics.add.collider(this.player,this.obstacles),this.swordSwinging=!1,this.mouseX=400,this.mouseY=300,this.movementThreshold=50,this.lastObstacleUpdate={x:400,y:300}}function v(){let s=!1;if(this.player.setVelocity(0),this.wasd.w.isDown?(this.player.setVelocityY(-200),s=!0):this.wasd.s.isDown&&(this.player.setVelocityY(200),s=!0),this.wasd.a.isDown?(this.player.setVelocityX(-200),s=!0):this.wasd.d.isDown&&(this.player.setVelocityX(200),s=!0),s&&t.Math.Distance.Between(this.player.x,this.player.y,this.lastObstacleUpdate.x,this.lastObstacleUpdate.y)>this.movementThreshold&&(B.call(this),this.lastObstacleUpdate={x:this.player.x,y:this.player.y}),this.swordSwinging){const i=t.Math.Angle.Between(this.player.x,this.player.y,this.mouseX,this.mouseY),a=40;this.sword.x=this.player.x+Math.cos(i)*a,this.sword.y=this.player.y+Math.sin(i)*a}}function M(){this.obstacles.clear(!0,!0);const e=t.Math.Between(10,20);for(let s=0;s<e;s++){let i,a,r=!1;for(;!r;)i=t.Math.Between(50,750),a=t.Math.Between(50,550),t.Math.Distance.Between(i,a,this.player.x,this.player.y)>100&&(r=!0);const n=this.obstacles.create(i,a,"wall");n.setScale(1.5),n.refreshBody()}}function B(){const e=t.Math.Between(2,5);let s=0;this.obstacles.getChildren().forEach(r=>{s<e&&Math.random()<.3&&r&&(r.destroy(),s++)});const a=t.Math.Between(2,5);for(let r=0;r<a;r++){let n,l,p=!1;for(;!p;){n=t.Math.Between(50,750),l=t.Math.Between(50,550);const D=t.Math.Distance.Between(n,l,this.player.x,this.player.y);let u=!1;this.obstacles.children.iterate(f=>{t.Math.Distance.Between(n,l,f.x,f.y)<40&&(u=!0)}),D>100&&!u&&(p=!0)}const y=this.obstacles.create(n,l,"wall");y.setScale(1.5),y.refreshBody()}}function S(){if(!this.swordSwinging){this.swordSwinging=!0,this.sword.setVisible(!0);const e=t.Math.Angle.Between(this.player.x,this.player.y,this.mouseX,this.mouseY),s=30;this.sword.x=this.player.x+Math.cos(e)*s,this.sword.y=this.player.y+Math.sin(e)*s,this.tweens.add({targets:this.sword,rotation:e+Math.PI/2,duration:100,yoyo:!0,repeat:1,onComplete:()=>{this.swordSwinging=!1,this.sword.setVisible(!1)}}),this.obstacles.getChildren().forEach(a=>{a&&t.Math.Distance.Between(this.sword.x,this.sword.y,a.x,a.y)<45&&a.destroy()})}}return(e,s)=>(g(),w("div",O,[s[0]||(s[0]=h("h2",null,"地牢冒险游戏",-1)),s[1]||(s[1]=h("div",{class:"game-info"},[h("p",null,"WASD控制移动 | 鼠标点击挥刀"),h("p",null,"移动会生成新的障碍物")],-1)),h("div",{ref_key:"gameContainer",ref:d,class:"game-canvas"},null,512)]))}}),T=k(G,[["__scopeId","data-v-e20f32f2"]]),Y=JSON.parse('{"title":"","description":"","frontmatter":{"outline":"deep"},"headers":[],"relativePath":"game2.md","filePath":"game2.md"}'),I={name:"game2.md"},U=Object.assign(I,{setup(m){return(d,c)=>(g(),w("div",null,[A(T)]))}});export{Y as __pageData,U as default};
